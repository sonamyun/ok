<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Swastha AI Dashboard</title>
  <link rel="stylesheet" href="dashboard.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="sidebar">
    <a href="#" class="sidebar-item active" id="home-sidebar-item" data-key="sidebarHome">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </a>
    <a href="#" class="sidebar-item" id="settings-sidebar-item" data-key="sidebarSettings">
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </a>
    <a href="#" class="sidebar-item" id="integrations-sidebar-item" data-key="sidebarIntegrations">
        <i class="fas fa-puzzle-piece"></i>
        <span>Integrations</span>
    </a>
    <a href="#" class="sidebar-item" id="security-sidebar-item" data-key="sidebarSecurity">
        <i class="fas fa-shield-alt"></i>
        <span>Security</span>
    </a>
    </div>
  <div class="main">
    <header>
      <div class="header-left">
        <h1 data-key="dashboardTitle">Welcome to swastha AI</h1>
        <div class="search-bar">
          <input type="text" data-key="globalSearchPlaceholder" placeholder="Global Search..." oninput="console.log('Searching: ' + this.value)" />
          <i class="fas fa-search"></i>
        </div>
      </div>
      <div class="header-right">
        <select id="language-select" onchange="setLanguage(this.value)">
          <option value="en" data-key="langEnglish">English</option>
          <option value="ne" data-key="langNepali">Nepali</option>
          </select>
        <div class="user-menu">
          <span id="user-email">Loading...</span> <i class="fas fa-user-circle user-icon"></i>
          <div class="user-dropdown-content">
            <a href="#" id="profile-link" onclick="console.log('Profile link clicked');" data-key="userProfile"><i class="fas fa-user-alt"></i> Profile</a>
            <a href="#" id="logout-button" data-key="userLogout"><i class="fas fa-sign-out-alt"></i> Logout</a>
          </div>
        </div>
      </div>
    </header>

    <div class="dashboard-content" id="dashboard-content">
      <div class="dashboard-grid">
        <section class="stats card">
          <h2 data-key="userStatsHeading">User Stats</h2>
          <p><span data-key="emailLabel">Email</span>: <span id="email-stat">Loading...</span></p>
          <p><span data-key="authTypeLabel">Auth Type</span>: <span id="authType-stat">Loading...</span></p>
          <p><span data-key="totalUsersLabel">Total Users</span>: <span id="totalUsers-stat">N/A</span></p>
          <p><span data-key="activeUsersLabel">Active Users</span>: <span id="activeUsers-stat">N/A</span></p>
        </section>

        <section class="trends card">
          <h2 data-key="medicalTrendsHeading">Medical Trends</h2>
          <p data-key="medicalTrendsParagraph">Recent health-related insights and updates. Stay informed about the latest in healthcare.</p>
          <ul>
            <li data-key="trendFlu">Increased flu cases reported in Bagmati Province.</li>
            <li data-key="trendDiabetes">New guidelines for diabetes management published.</li>
            <li data-key="trendTelemedicine">Telemedicine adoption growing.</li>
          </ul>
        </section>

        <section class="quick-actions card">
          <h2 data-key="quickActionsHeading">Quick Actions</h2>
          <div class="action-buttons">
            <button class="btn help" onclick="redirectHelp()" data-key="actionAskHelp">
              <i class="fas fa-medkit"></i> Ask Help
            </button>
            <button class="btn locate" onclick="redirectLocate()" data-key="actionLocate">
              <i class="fas fa-map-marker-alt"></i> Locate
            </button>
            <button class="btn doctor" onclick="askDoctor()" data-key="actionAskDoctor">
              <i class="fas fa-user-md"></i> Ask Doctor
            </button>
          </div>
        </section>

        <section class="chatbox card">
          <h2 data-key="chatHeading">Chat with Swastha AI</h2>
          <div class="chat-input-area">
            <input type="text" id="chat-input" data-key="chatInputPlaceholder" placeholder="Describe your medical symptoms (e.g., I have a headache and feel dizzy)..." />
            <button class="submit-btn" onclick="sendMessage()" data-key="sendButton">Send</button>
          </div>
          <div class="response" data-key="chatInitialResponse">Type your symptoms above to get assistance.</div>
          <div class="smart-features">
              <p class="small-text"><i class="fas fa-lightbulb"></i> <span data-key="smartSuggestionsText">Smart suggestions: "Meditation Helps decrease your stress"</span></p>
              <button class="export-btn" onclick="console.log('Export chat clicked');" data-key="exportChatButton"><i class="fas fa-file-export"></i> Export Chat (PDF)</button>
          </div>
        </section>

        <section class="to-do-list card">
            <h2 data-key="todoListHeading"><i class="fas fa-clipboard-list"></i> To-Do List</h2>
            <ul>
              <li data-key="todoCheckup">Schedule annual check-up</li>
              <li data-key="todoRecipes">Research healthy recipes</li>
              <li data-key="todoExercise">Exercise for 30 minutes</li>
            </ul>
        </section>

        <section class="calendar card">
            <h2 data-key="calendarHeading"><i class="fas fa-calendar-alt"></i> Calendar</h2>
            <p><span data-key="calendarToday">Today</span>: <span data-key="calendarNoEvents">No special events.</span> <br> <span data-key="calendarUpcoming">Upcoming</span>: <span data-key="calendarDentalAppointment">Dental appointment (July 10).</span></p>
        </section>

        <section class="notifications card">
            <h2 data-key="notificationsHeading"><i class="fas fa-bell"></i> Notifications</h2>
            <ul>
              <li data-key="notificationMessage">New message from Dr. Shraddha.</li>
              <li data-key="notificationReminder">Reminder: Take medication at 8 PM.</li>
            </ul>
        </section>

        <section class="kpi-card card">
            <h2 data-key="healthScoreHeading"><i class="fas fa-tachometer-alt"></i> Health Score</h2>
            <div class="progress-ring-container">
                <div class="progress-ring" data-progress="75">
                    <svg class="progress-svg" viewBox="0 0 100 100">
                        <circle class="progress-bg" cx="50" cy="50" r="45"></circle>
                        <circle class="progress-bar" cx="50" cy="50" r="45"></circle>
                    </svg>
                    <div class="progress-text">75%</div>
                </div>
                <p data-key="healthIndexParagraph">Overall Health Index</p>
            </div>
        </section>

      </div>
    </div>

    <div id="settings-panel" class="settings-panel" style="display: none;">
      <h2 data-key="settingsPanelHeading"><i class="fas fa-cog"></i> Settings</h2>
      <div class="settings-tabs">
        <button class="settings-tab active" data-tab="user-prefs" data-key="tabUserPrefs">User Preferences</button>
        <button class="settings-tab" data-tab="account-settings" data-key="tabAccountSettings">Account Settings</button>
        <button class="settings-tab" data-tab="customization" data-key="tabCustomization">Customization</button>
        <button class="settings-tab" data-tab="system-settings" data-key="tabSystemSettings">System Settings</button>
      </div>

      <div id="user-prefs" class="settings-content active">
        <h3 data-key="userPrefsSubheading">User Preferences</h3>
        <div class="setting-item">
          <label for="theme-select" data-key="themeLabel">Theme:</label>
          <select id="theme-select">
            <option value="light" data-key="themeLight">Light</option>
            <option value="dark" data-key="themeDark">Dark</option>
            <option value="auto" data-key="themeAuto">Auto</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="notification-email-toggle" data-key="emailNotificationsLabel">Email Notifications:</label>
          <input type="checkbox" id="notification-email-toggle" onchange="console.log('Email notifications toggled to: ' + this.checked)">
        </div>
        <div class="setting-item">
          <label for="notification-sms-toggle" data-key="smsNotificationsLabel">SMS Notifications:</label>
          <input type="checkbox" id="notification-sms-toggle" onchange="console.log('SMS notifications toggled to: ' + this.checked)">
        </div>
        <div class="setting-item">
            <label for="time-zone-select" data-key="timeZoneLabel">Time Zone:</label>
            <select id="time-zone-select" onchange="console.log('Time zone changed to: ' + this.value)">
                <option value="Asia/Kathmandu" data-key="timezoneKathmandu">Kathmandu (GMT+05:45)</option>
                <option value="America/New_York" data-key="timezoneNewYork">New York (EST)</option>
                </select>
        </div>
        <div class="setting-item">
            <label for="data-refresh-rate" data-key="dataRefreshRateLabel">Data Refresh Rate:</label>
            <select id="data-refresh-rate" onchange="console.log('Data refresh rate changed to: ' + this.value)">
                <option value="auto" data-key="refreshAuto">Automatic</option>
                <option value="manual" data-key="refreshManual">Manual</option>
            </select>
        </div>
        <button class="save-settings-btn" data-category="User Preferences" data-key="savePrefsButton"><i class="fas fa-save"></i> Save Preferences</button>
      </div>

      <div id="account-settings" class="settings-content">
        <h3 data-key="accountSettingsSubheading">Account Settings</h3>
        <div class="setting-item">
            <label for="profile-name" data-key="profileNameLabel">Name:</label>
            <input type="text" id="profile-name" value="User Name" onchange="console.log('Profile name changed to: ' + this.value)">
        </div>
        <div class="setting-item">
            <label for="profile-email" data-key="profileEmailLabel">Email:</label>
            <input type="email" id="profile-email" value="user@example.com" disabled>
        </div>
        <div class="setting-item">
            <label data-key="passwordSecurityLabel">Password & Security:</label>
            <button class="btn-small" onclick="console.log('Change Password clicked');" data-key="changePasswordButton">Change Password</button>
            <button class="btn-small" onclick="console.log('Enable 2FA clicked');" data-key="enable2FAButton">Enable 2FA</button>
        </div>
        <div class="setting-item">
            <label data-key="privacyControlsLabel">Privacy Controls:</label>
            <button class="btn-small" onclick="console.log('Manage Data Sharing clicked');" data-key="manageDataSharingButton">Manage Data Sharing</button>
        </div>
        <button class="save-settings-btn" data-category="Account Settings" data-key="saveAccountSettingsButton"><i class="fas fa-save"></i> Save Account Settings</button>
      </div>

      <div id="customization" class="settings-content">
        <h3 data-key="customizationSubheading">Customization</h3>
        <div class="setting-item">
            <label for="widget-layout" data-key="widgetLayoutLabel">Widget Layout:</label>
            <button class="btn-small" onclick="console.log('Drag & Drop Editor opened');" data-key="dragDropEditorButton">Drag & Drop Editor</button>
        </div>
        <div class="setting-item">
            <label for="default-landing-page" data-key="defaultLandingPageLabel">Default Landing Page:</label>
            <select id="default-landing-page" onchange="console.log('Default landing page changed to: ' + this.value)">
                <option value="home" data-key="landingHome">Home Dashboard</option>
                <option value="chat" data-key="landingChat">Chat with AI</option>
                <option value="trends" data-key="landingTrends">Medical Trends</option>
            </select>
        </div>
        <button class="save-settings-btn" data-category="Customization" data-key="saveCustomizationsButton"><i class="fas fa-save"></i> Save Customizations</button>
      </div>

      <div id="system-settings" class="settings-content">
        <h3 data-key="systemSettingsSubheading">System Settings</h3>
        <div class="setting-item">
            <label data-key="rolePermissionsLabel">Role & Permissions:</label>
            <p data-key="adminAccessRequired">Admin access required.</p>
        </div>
        <div class="setting-item">
            <label data-key="backupRestoreLabel">Backup & Restore:</label>
            <button class="btn-small" onclick="console.log('Create Backup clicked');" data-key="createBackupButton">Create Backup</button>
            <button class="btn-small" onclick="console.log('Restore from Backup clicked');" data-key="restoreBackupButton">Restore from Backup</button>
        </div>
        <div class="setting-item">
            <label data-key="versionInfoLabel">Version Info:</label>
            <span data-key="versionNumber">v1.0.0 (Build 20250705)</span>
        </div>
      </div>
    </div>

    <div id="integrations-panel" class="settings-panel" style="display: none;">
        <h2 data-key="integrationsPanelHeading"><i class="fas fa-puzzle-piece"></i> Integrations</h2>
        <p data-key="integrationsParagraph">Connect Swastha AI with your favorite third-party applications.</p>
        <div class="integration-item">
            <h3 data-key="googleAnalyticsHeading">Google Analytics</h3>
            <p data-key="googleAnalyticsDesc">Connect to view your website traffic data.</p>
            <button class="btn-small" onclick="console.log('Connect Google Analytics clicked');" data-key="connectButton">Connect</button>
        </div>
        <div class="integration-item">
            <h3 data-key="stripeHeading">Stripe (Payments)</h3>
            <p data-key="stripeDesc">Integrate for payment processing.</p>
            <button class="btn-small" onclick="console.log('Connect Stripe clicked');" data-key="connectButton">Connect</button>
        </div>
        <div class="integration-item">
            <h3 data-key="slackTeamsHeading">Slack / Teams</h3>
            <p data-key="slackTeamsDesc">Receive notifications and alerts directly.</p>
            <button class="btn-small" onclick="console.log('Connect Slack/Teams clicked');" data-key="connectButton">Connect</button>
        </div>
    </div>

    <div id="security-panel" class="settings-panel" style="display: none;">
        <h2 data-key="securityPanelHeading"><i class="fas fa-shield-alt"></i> Security & Access</h2>
        <p data-key="securityParagraph">Manage security settings and review access logs.</p>
        <div class="security-item">
            <h3 data-key="auditLogsHeading">Audit Logs</h3>
            <p data-key="auditLogsDesc">Review all system activities and changes.</p>
            <button class="btn-small" onclick="console.log('View Audit Logs clicked');" data-key="viewLogsButton">View Logs</button>
        </div>
        <div class="security-item">
            <h3 data-key="sessionManagementHeading">Session Management</h3>
            <p data-key="sessionManagementDesc">See active sessions and log out devices.</p>
            <button class="btn-small" onclick="console.log('Manage Sessions clicked');" data-key="manageSessionsButton">Manage Sessions</button>
        </div>
        <div class="security-item">
            <h3 data-key="userRolesHeading">User Roles</h3>
            <p data-key="userRolesDesc">Define and manage user roles and permissions.</p>
            <button class="btn-small" onclick="console.log('Manage User Roles clicked');" data-key="manageRolesButton">Manage Roles</button>
        </div>
    </div>
  </div>

  <div id="membership-popup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
      <h3 data-key="membershipRequiredHeading">Membership Required</h3>
      <p data-key="membershipRequiredParagraph">Please upgrade your membership to access this feature.</p>
      <button onclick="closeMembershipPopup()" data-key="closeButton">Close</button>
    </div>
  </div>

  <script type="module" src="dashboard.js"></script>
  <script src="dashboard-translation.js"></script> <script type="module">
    // Import auth for logout
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    const auth = getAuth();

    // General utility functions for dashboard.html
    window.redirectHelp = function() {
      window.location.href = "emergency.html"; // Adjusted path to assume dashboard.html is in same directory
    };

    window.redirectLocate = function() {
      const location = encodeURIComponent("hospitals near Mahalaxmi Lalitpur Cosmos College Block B");
      window.open(`https://www.google.com/maps/search/?api=1&query=${location}`, "_blank"); // Corrected Google Maps URL
    };

    window.askDoctor = function() {
      document.getElementById("membership-popup").style.display = "flex";
      // Ensure the text within the popup is translated when it appears
      updatePopupContent('membership-popup', {
          heading: 'membershipRequiredHeading',
          paragraph: 'membershipRequiredParagraph',
          button: 'closeButton'
      });
    };

    window.closeMembershipPopup = function() {
      document.getElementById("membership-popup").style.display = "none";
    };

    // The setLanguage function is now handled by dashboard-translation.js
    // window.changeLanguage = function(lang) {
    //   console.log(`Language changed to: ${lang}`);
    //   // Add logic here to change UI language dynamically
    // };

    window.sendMessage = function() {
      const chatInput = document.getElementById('chat-input');
      const responseDiv = document.querySelector('.chatbox .response');
      const message = chatInput.value.trim();

      if (message) {
        // Use translation for initial response
        responseDiv.textContent = `${getTranslation('youLabel')}: ${message}\n${getTranslation('swasthaAILabel')}: ${getTranslation('processingRequest')}`;
        chatInput.value = ''; // Clear input

        // Simulate AI response after a delay
        setTimeout(() => {
          // Use translation for simulated AI response
          responseDiv.textContent = `${getTranslation('youLabel')}: ${message}\n${getTranslation('swasthaAILabel')}: ${getTranslation('aiResponseHeadacheDizzy')}`;
        }, 2000);
      } else {
        // Use translation for empty input message
        responseDiv.textContent = `${getTranslation('swasthaAILabel')}: ${getTranslation('pleaseTypeSymptoms')}`;
      }
    };

    // Logout Function
    document.getElementById("logout-button")?.addEventListener("click", async (e) => {
      e.preventDefault();
      try {
        await signOut(auth);
        window.location.href = "../index.html"; // Redirect to login page
      } catch (error) {
        console.error("Logout Error:", error);
        alert(`${getTranslation('logoutFailed')}: ${error.message}`); // Translate alert message
      }
    });

    // Toggle user dropdown menu
    document.querySelector('.user-icon').addEventListener('click', function(event) {
      event.stopPropagation(); // Prevent click from immediately closing the dropdown
      this.nextElementSibling.classList.toggle('show');
    });

    // Close the dropdown if the user clicks outside of it
    window.addEventListener('click', function(event) {
      if (!event.target.closest('.user-menu')) {
        var dropdowns = document.getElementsByClassName("user-dropdown-content");
        for (var i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // Settings/Integrations/Security Panel Toggling
    const dashboardContent = document.getElementById('dashboard-content');
    const settingsPanel = document.getElementById('settings-panel');
    const integrationsPanel = document.getElementById('integrations-panel');
    const securityPanel = document.getElementById('security-panel');

    function showPanel(panelToShow, sidebarItemId) {
        dashboardContent.style.display = 'none';
        settingsPanel.style.display = 'none';
        integrationsPanel.style.display = 'none';
        securityPanel.style.display = 'none';
        if (panelToShow) {
            panelToShow.style.display = 'block';
        } else {
            dashboardContent.style.display = 'grid'; // Restore grid display for dashboard
        }
        document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
        if (sidebarItemId) {
            document.getElementById(sidebarItemId).classList.add('active');
        }
    }

    document.getElementById('home-sidebar-item').addEventListener('click', function(e) {
        e.preventDefault();
        showPanel(null, 'home-sidebar-item');
    });

    document.getElementById('settings-sidebar-item').addEventListener('click', function(e) {
        e.preventDefault();
        showPanel(settingsPanel, 'settings-sidebar-item');
    });

    document.getElementById('integrations-sidebar-item').addEventListener('click', function(e) {
        e.preventDefault();
        showPanel(integrationsPanel, 'integrations-sidebar-item');
    });

    document.getElementById('security-sidebar-item').addEventListener('click', function(e) {
        e.preventDefault();
        showPanel(securityPanel, 'security-sidebar-item');
    });


    // Settings Tabs Logic
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.querySelectorAll('.settings-content').forEach(content => content.style.display = 'none');
            document.getElementById(this.dataset.tab).style.display = 'block';
        });
    });

    // Progress Ring Initialization
    document.querySelectorAll('.progress-ring').forEach(ring => {
        const progress = ring.dataset.progress; // Get progress from data-progress attribute
        const radius = 45; // Hardcoded from SVG
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (progress / 100) * circumference;
        const progressBar = ring.querySelector('.progress-bar');
        const progressText = ring.querySelector('.progress-text');

        progressBar.style.strokeDasharray = `${circumference} ${circumference}`;
        progressBar.style.strokeDashoffset = offset;
        progressBar.style.transition = 'stroke-dashoffset 0.8s ease-out'; // Animation

        progressText.textContent = `${progress}%`;
    });


    // --- Theme Switcher Functionality ---
    const themeSelect = document.getElementById('theme-select');

    function applyTheme(theme) {
        document.body.classList.remove('light-theme', 'dark-theme'); // Remove existing themes

        if (theme === 'dark') {
            document.body.classList.add('dark-theme');
        } else if (theme === 'light') {
            document.body.classList.add('light-theme');
        } else if (theme === 'auto') {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.add('light-theme');
            }
        }
        localStorage.setItem('selectedTheme', theme); // Save preference
    }

    // Load theme on page load
    const savedTheme = localStorage.getItem('selectedTheme') || 'light'; // Default to light if no preference
    themeSelect.value = savedTheme; // Set dropdown to saved value
    applyTheme(savedTheme); // Apply the theme


    themeSelect.addEventListener('change', (event) => {
        applyTheme(event.target.value);
    });

    // --- Settings Save Buttons Functionality ---
    document.querySelectorAll('.save-settings-btn').forEach(button => {
        button.addEventListener('click', () => {
            const category = button.dataset.category;
            // Use translation for the alert message
            alert(`${getTranslation('settingsSavedPrefix')} ${getTranslation(category.replace(/\s/g, ''))}${getTranslation('settingsSavedSuffix')}`);
            console.log(`Settings saved for ${category}! (Functionality to save to backend/storage would go here)`);
        });
    });

  </script>
</body>
</html>